<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>GPS positions of cell towers</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" href="img/tower.png">

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
		<link rel="stylesheet" href="css/style.css">
		<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
		<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
		<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />
		<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
    </head>
	
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
		
		<div id="mySidenav" class="sidenav">
			<h1> Slovakia </h1>
			<li><a href="#">Map</a>
				<ol class="sub-menu">
					<form action="">
						<input type="checkbox" name="operator" value="1" checked> Orange <img src="img/1.png" alt="Tower icon" height="20" width="20"><br>
						<input type="checkbox" name="operator" value="2" checked> Telekom <img src="img/2.png" alt="Tower icon" height="20" width="20"><br>
						<input type="checkbox" name="operator" value="6" checked> O2 <img src="img/6.png" alt="Tower icon" height="20" width="20"><br>
						<input type="checkbox" name="operator" value="3" checked> 4ka (Swan) <img src="img/3.png" alt="Tower icon" height="20" width="20">
						<p>Lat: <input type="number" class="radius" readonly="readonly" id=lat></p>
						<p>Lng: <input type="number" class="radius" readonly="readonly" id=lon></p>
						<p>Radius: <input type="number" id="radius" class="radius" value="1000"> m</p> 
						<!-- button show towers-->
						<div>
							<button id="show" type="button" onclick="showStations()">Show</button>
						</div>								
					</form>
				</ol>	
			</li>				
			<li><a href="#">Search</a>
				<ol class="sub-menu">
					<p>GPS location</p>
					<p>Cell location</p>
				</ol>				
			</li>
			<li><a href="#">Measurements</a></li>
			<li><a href="#">Statistics</a>
				<ol class="sub-menu">
					<table>
						  <tr>
							<th>Number of cells</th>
							<td>
								<div style="display: inline" class="the-return"></div>
							</td> 
						  </tr>
					</table>
				</ol>				
			</li>		
		</div>	
			
		<!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
		<div id="main">	

			<h1>
				<img src="img/tower.png" alt="Tower icon" height="50" width="50">
				GPS positions of cell towers
			</h1>
			
			<!-- <div id='output' class='ui-control'> -->
				<!-- Clicked position: <code id='click'></code><br/> -->
				<!-- Mousemove: <code id='mousemove'></code><br/> -->
			<!-- </div>				 -->
			<!-- <span style="font-size:30px;cursor:pointer" onclick="openNav()" class="topcorner">&#9776; Statistics</span>     <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>-->
			
			<div id='map'></div>
					
			<script>
				L.mapbox.accessToken = 'pk.eyJ1Ijoic3pha3N6a2EiLCJhIjoiY2l1OGlwdzdpMDAxODJ5cGp2OHRtZW5rYSJ9.-Ve3EddQ-PQ3hsbiRwyAkQ';
				var map = L.mapbox.map('map', 'szakszka.1ljgmpd6');
				var aktPos;
				var coord;
				var lat;
				var lon;
				
				map.scrollWheelZoom.enable();
				
				var info = L.control();
				info.onAdd = function (map) {
					this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
					return this._div;
				};
				info.addTo(map);	
					
				map.on('mousemove', function(e) {
					<!-- window[e.type].innerHTML = e.latlng.toString(); -->
					info._div.innerHTML = '<b>Position:</b>' +  e.latlng.toString();
				});		

				var marker;
				map.on('click', function (e) {
					if (marker != null){
						map.removeLayer(marker);
					}
					marker = new L.Marker(e.latlng);
					map.addLayer(marker);
					aktPos = e.latlng;
					coord = aktPos.toString().split(',');
					lat = coord[0].split('(');
					lat = lat[1];
					lon = coord[1].split(')');
					lon = lon[0].split(' ');
					lon = lon[1];
					$('#lat').val(lat);
					$('#lon').val(lon);
					marker.bindPopup("<b>Clicked position!</b><br />" + aktPos);
				});
				
				var basicLayer;
				function showStations(){	
					var nets = new Array();
					$('input[name="operator"]:checked').each(function() {
						nets.push(this.value);
					});
					<!-- alert("Number of selected operators: "+nets.length+"\n"+"And, they are: "+nets); -->

					$.ajax({
						url:"http://localhost/PDT/API/getStations.php",
						data:{lat:$('#lat').val(), lon:$('#lon').val(),radius:$('#radius').val(), nets: nets}
					}).done(function(data){		
						if (data != 0) {
							if (basicLayer) map.removeLayer(basicLayer);
							basicLayer = L.geoJson($.parseJSON(data),{
							  pointToLayer: function(feature,latlng){
								var icon = L.icon({
									iconUrl: 'http://localhost/PDT/szakszka_web/img/' + feature.properties.net + '.png',
									iconSize: [40,40]
								});
								var marker = L.marker(latlng,{icon: icon});
								marker.bindPopup("<b>" + feature.properties.title + '</b><br/>' + feature.properties.description);
								return marker;
							  }
							});
							L.circle([$('#lat').val(),$('#lon').val()], $('#radius').val()).addTo(basicLayer);
							map.addLayer(basicLayer);
						}
					
						<!-- if (basicLayer) map.removeLayer(basicLayer);				 -->
						<!-- basicLayer = L.mapbox.featureLayer($.parseJSON(data)); -->
						<!-- map.addLayer(basicLayer); -->
					});
				};			
			</script>
		</div>
		
		<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.0.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
		<script src="js/sidebar.js"></script>
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>
		
		<script src="js/jquery.geolocation.js" type="text/javascript"></script>	
		<!-- $.geolocation.getCurrentPosition()-->
		<script>
			$.geolocation.getCurrentPosition(function(position){
				<!-- console.log(position); -->
				<!-- console.log(position.coords.longitude); -->
				<!-- console.log(position.coords.latitude); -->
				$('#lat').val(position.coords.latitude);
				$('#lon').val(position.coords.longitude);
				var geojson = [
			  {
				"type": "Feature",
				"geometry": {
				  "type": "Point",
				  "coordinates": [position.coords.longitude,position.coords.latitude]
				},
				"properties": {
				  "title": "Actual Position",
				  "description":"",
				  "marker-color": "#fc4353",
				  "marker-size": "small",
				  "marker-symbol": "marker-stroked"
				}
			  }];
					
			L.mapbox.featureLayer(geojson).addTo(map);
			});	
		</script>		
		
        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='https://www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X','auto');ga('send','pageview');
        </script>
	</body>
	
	<footer id="footer">
		<p>Posted by: Katarína Szakszová</p>
		<p>Contact information: <a href="mailto:szakszova.katarina@gmail.com">
		szakszova.katarina@gmail.com</a>.</p>
	</footer>
</html>
